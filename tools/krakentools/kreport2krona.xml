<tool id="kreport2krona" name="Convert kraken report file" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <description>to krona text file</description>
    <requirements>
        <requirement type="package" version="1.2">krakentools</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
kreport2krona.py 
    --report '$report' 
    --output '$output' 
    $intermediate_ranks
    ]]></command>
    <inputs>
        <param argument="--report" type="data" format="tabular" label="Kraken report file" />
        <param argument="--intermediate-ranks" type="boolean" checked="false" truevalue="--intermediate-ranks" falsevalue="" label="Include intermediate (i.e. non-standard) ranks"/>
    </inputs>
    <outputs>
        <data name="output" format="tabular" />
    </outputs>
    <tests>
        <test>
            <param name="report" value="sample.tabular"/>
            <output name="output" file="output.tabular"/>
        </test>
        <test>
            <param name="report" value="sample.tabular"/>
            <param name="intermediate_ranks" value="--intermediate-ranks"/>
            <output name="output" file="output_intermediate.tabular"/>
        </test>
    </tests>
    <help><![CDATA[
        This program takes a Kraken report file and prints out a krona-compatible TEXT file

        Usage/options:
        python kreport2krona.py
            -r/--report MYFILE.KREPORT........Kraken report file
            -o/--output MYFILE.KRONA..........Output Krona text file

        Optional:
            --no-intermediate-ranks...........[default]only output standard levels [D,P,C,O,F,G,S]
            --intermediate-ranks..............include non-standard levels
        
        Example output:
        --no-intermediate-ranks
            6298        Unclassified
            8           k__Bacteria
            4           k__Bacteria     p_Proteobacteria
            6           k__Bacteria     p_Proteobacteria    c__Gammaproteobacteria
            ...
            
        --intermediate-ranks
            6298        Unclassified
            79          x__root
            0           x__root     x__cellular_organisms
            8           x__root     x__cellular organisms   k__Bacteria
            4           x__root     x__cellular organisms   k__Bacteria     p__Proteobacteria
            6           x__root     x__cellular organisms   k__Bacteria     p__Proteobacteria   c__Gammaproteobacteria
            ....
    ]]></help>
    <citations>
        <citation type="doi">
@misc{
  author = {Lu, Jennifer},
  year = {2022},
  title = {Metagenome analysis using the Kraken software suite},
  url = {https://www.nature.com/articles/s41596-022-00738-y},
}</citation>
    </citations>
</tool>